# 超算集群的物理搭建
http://linux.vbird.org/linux_server/0600cluster.php
https://zhuanlan.zhihu.com/p/25012912

## 硬件层面
## 硬件参数

<!--
- 两台节点：intel i7 4核，6g内存，1T硬盘，独立显卡（gpu太弱，不用它来计算，只用于连接显示器）intel Gigabit以太网卡。

- 网络连接：gigabit以太网switch hub（L2交换机），网线，需要连接互联网 -->


### 网络拓扑
有了节点，就需要对节点进行连接，评价一个网络的准则应该是，对于一定数量的节点，点对点的带宽越高，折半宽度越大，或者网络直径越小，点对点延迟越小，质量就越好。

简单组网的拓扑结构有：
  1. 星型结构：
      - 结构简单，便于维护，广播传送
  2. 环形结构（主要用在令牌网络）
      - 维护困难，扩展性差
  3. 总线结构：
      - 共用宽带，排队发送

高级组网：树、立方体、多层总线、交叉开关

建议：直接用网线连交换机，星型网络
![节点结构图](img_url)

### 存储
对于小型集群，存储的设计可以单独设计NFS也可以直接利用节点存储

NFS是一种网络文件系统，利用TCP/IP协议可以像访问本地文件一样访问网络文件，其优点之一就是NFS上的文件的绝对路径对所有节点相同（不用改相关参数）

NIS是集中控制几个系统管理数据库的网络用品。NIS简化了UNIX和LINUX桌面客户的管理工作，客户端利用它可以使用中心服务器的管理文件。桌面系统的用户无需建立他们自己的/etc/passwd，他们只简单的使用维护在NIS服务器的文件即可。

建议：给master节点配置大部分的存储容量，Slave节点配置较小的存储容量，然后将master的划出一块做NFS

## 系统安装
### 操作系统
推荐CentOS 6.5， Master和Slave节点相同（全部用服务器版本好了，桌面版有些鸡肋）

https://www.zhihu.com/question/28759901
https://www.zhihu.com/question/40737404


清华镜像站下载：
https://mirrors.tuna.tsinghua.edu.cn/centos/
教育内网，速度飞快，其他一些源也有

### 环境依赖与软件安装
CentOS 自带G++
参考文章里提供了RSH这一远程命令执行软件，可以一试。

其他主要软件：MPICH3, Fortran, NFS


### 网络配置

a）网络连接，使用交换机集线器连接，连接方式多种多样，由于我们的组装的规模很小，所以，低于交换机的接口数的时候就把交换机作为行星网络的中心，如果需要多个交换机，就采用层状交换机结构。出于简单考虑，IP没有设成静态，直接采用路由器的hdcp功能，动态分配ip，如果要长期使用，请设置成静态ip。那么自动分配的ip分别是XXX.65.121.82和 XXX.65.121.102,分别对应的名称是server081和server156，（我在实验室随便拉出来的两台机器）。更改静态ip需要更改 ／etc／network／interface 文件。

b）查询ip地址，可以直接去gui的界面去看，也可以输入<ifconfig>命令。

c）更改／etc／hosts文件，把ip和名字对应上，这样操作起来比较方便，不用处处都输入ip。如果查看自己的hostname，可以查看／etc／hostname文件。

d）然后重启network服务

sudo /etc/init.d/networking restart
测试两台机器是否能够ping通，如果，可以，说明网络没问题，如果出现问题，检查网络连接和网络设置。

e）用ssh生成密钥

ssh-keygen
f）同步密钥，可以进行免密ssh登陆。

cd ~/.ssh
cp id_rsa.pub authorized_keys
rsync -avz ~/.ssh XXX.65.121.102:~/.
再测试两台机器是否可以免密ssh登陆，如果不行，检查问题。

这时候有人会问，我现在有两台机器，可以拷贝一下密钥，要是我有n台机器，岂不是相互都要拷贝n-1个密钥？解决的方法很简单就是大家都用一个密钥，这样进行访问的时候就不用互相交叉进行，而是由一个中心进行相互通信。
